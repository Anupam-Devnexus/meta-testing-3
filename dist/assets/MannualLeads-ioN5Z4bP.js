import{j as a,a as A,p as E,k as L}from"./index-ePZmuw5s.js";import{r as o,u as O}from"./react-DNgDP3D6.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),M=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,r,m)=>m?m.toUpperCase():r.toLowerCase()),N=t=>{const s=M(t);return s.charAt(0).toUpperCase()+s.slice(1)},R=(...t)=>t.filter((s,r,m)=>!!s&&s.trim()!==""&&m.indexOf(s)===r).join(" ").trim(),U=t=>{for(const s in t)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var B={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=o.forwardRef(({color:t="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:m,className:c="",children:d,iconNode:u,...h},p)=>o.createElement("svg",{ref:p,...B,width:s,height:s,stroke:t,strokeWidth:m?Number(r)*24/Number(s):r,className:R("lucide",c),...!d&&!U(h)&&{"aria-hidden":"true"},...h},[...u.map(([x,g])=>o.createElement(x,g)),...Array.isArray(d)?d:[d]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=(t,s)=>{const r=o.forwardRef(({className:m,...c},d)=>o.createElement(I,{ref:d,iconNode:s,className:R(`lucide-${G(N(t))}`,`lucide-${t}`,m),...c}));return r.displayName=N(t),r};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],F=C("mail",T);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],H=C("message-circle",P),v=["bg-blue-100 text-blue-700","bg-green-100 text-green-700","bg-yellow-100 text-yellow-700","bg-purple-100 text-purple-700","bg-red-100 text-red-700"],q=({leads:t=[],patchApi:s})=>{const[r,m]=o.useState({}),[c,d]=o.useState({}),[u,h]=o.useState(""),[p,x]=o.useState(""),[g,b]=o.useState(!1);if(!JSON.parse(localStorage.getItem("UserDetails"))?.token)return a.jsx("p",{className:"text-red-600",children:"User not authenticated. Please log in."});const k=o.useMemo(()=>{if(!t.length)return[];const e=new Set;return t.forEach(l=>Object.keys(l).forEach(n=>e.add(n))),Array.from(e)},[t]),y=e=>{m(l=>({...l,[e]:!l[e]}))},w=()=>{d(e=>{const l={...e};return Object.keys(r).filter(n=>r[n]).forEach(n=>{l[n]={remark1:u,remark2:p}}),l})},_=e=>{if(!e.email)return;const l=encodeURIComponent("Follow-up on your inquiry"),n=encodeURIComponent(`Hello ${e.field_data?.find(i=>i.name==="full_name")?.values[0]||"Customer"},

Remark 1: ${c[e._id]?.remark1||e.remarks1||""}
Remark 2: ${c[e._id]?.remark2||e.remarks2||""}`);window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${e.email}&su=${l}&body=${n}`,"_blank")},S=e=>{const l=e.field_data?.find(i=>i.name==="phone")?.values[0];if(!l)return;const n=encodeURIComponent(`Hello ${e.field_data?.find(i=>i.name==="full_name")?.values[0]||"Customer"},
Remark 1: ${c[e._id]?.remark1||e.remarks1||""}
Remark 2: ${c[e._id]?.remark2||e.remarks2||""}`);window.open(`https://wa.me/${l}?text=${n}`,"_blank")},$=async()=>{if(!Object.values(r).some(Boolean)){alert("No rows selected!");return}b(!0);try{const e=Object.keys(r).filter(l=>r[l]).map(l=>({_id:l,remarks1:c[l]?.remark1,remarks2:c[l]?.remark2}));await A.patch(`${s}`,{updates:e}),alert("Remarks updated ✅")}catch(e){console.error("Error updating remarks:",e),alert("Failed to update remarks ❌")}finally{b(!1)}};return t.length?a.jsxs("div",{className:"p-6 space-y-6 bg-gray-50 rounded-lg shadow-lg",children:[a.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-3",children:[a.jsx("input",{type:"text",placeholder:"Global Remark 1",value:u,onChange:e=>h(e.target.value),className:"border px-3 py-2 rounded-lg w-full md:w-1/2"}),a.jsx("input",{type:"text",placeholder:"Global Remark 2",value:p,onChange:e=>x(e.target.value),className:"border px-3 py-2 rounded-lg w-full md:w-1/2"}),a.jsx("button",{onClick:w,disabled:!Object.values(r).some(Boolean),className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition",children:"Apply Global Remarks"}),a.jsx("button",{onClick:$,disabled:!Object.values(r).some(Boolean)||g,className:"ml-auto px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition",children:g?"Submitting...":"Submit Changes"})]}),a.jsx("div",{className:"overflow-x-auto rounded-lg shadow",children:a.jsxs("table",{className:"min-w-full bg-white text-sm",children:[a.jsx("thead",{className:"bg-gray-100 text-gray-700 uppercase text-xs",children:a.jsxs("tr",{children:[a.jsx("th",{className:"p-3 border text-center",children:"Select"}),k.map(e=>a.jsx("th",{className:"p-3 border text-left",children:e},e)),a.jsx("th",{className:"p-3 border text-center",children:"Remark1"}),a.jsx("th",{className:"p-3 border text-center",children:"Remark2"}),a.jsx("th",{className:"p-3 border text-center",children:"Actions"})]})}),a.jsx("tbody",{children:t.map((e,l)=>a.jsxs("tr",{className:`transition hover:bg-gray-50 ${l%2===0?"bg-white":"bg-gray-50"}`,children:[a.jsx("td",{className:"p-3 border text-center",children:a.jsx("input",{type:"checkbox",checked:r[e._id]||!1,onChange:()=>y(e._id),className:"w-4 h-4"})}),k.map(n=>a.jsx("td",{className:"p-3 border",children:Array.isArray(e[n])?a.jsx("div",{className:"flex flex-wrap gap-1",children:e[n].map((i,j)=>typeof i=="string"?a.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${v[j%v.length]}`,children:i},j):a.jsx("span",{className:"px-2 py-1 text-xs rounded bg-gray-200",children:JSON.stringify(i)},j))}):e[n]?.toString()||"N/A"},n)),a.jsx("td",{className:"p-3 border",children:a.jsx("input",{type:"text",value:c[e._id]?.remark1||e.remarks1||"",onChange:n=>d(i=>({...i,[e._id]:{...i[e._id],remark1:n.target.value}})),className:"border px-2 py-1 rounded w-full"})}),a.jsx("td",{className:"p-3 border",children:a.jsx("input",{type:"text",value:c[e._id]?.remark2||e.remarks2||"",onChange:n=>d(i=>({...i,[e._id]:{...i[e._id],remark2:n.target.value}})),className:"border px-2 py-1 rounded w-full"})}),a.jsxs("td",{className:"p-3 border flex justify-center gap-2",children:[a.jsx("button",{onClick:()=>_(e),className:"text-blue-600 hover:text-blue-800 transition",children:a.jsx(F,{size:18})}),a.jsx("button",{onClick:()=>S(e),className:"text-green-600 hover:text-green-800 transition",children:a.jsx(H,{size:18})})]})]},e._id))})]})})]}):a.jsx("p",{className:"text-gray-500 text-center py-6",children:"No data available"})},z=E(t=>({leads:[],loading:!1,error:null,fetchLeads:async()=>{const s=JSON.parse(localStorage.getItem("UserDetails"))?.token;if(!s){t({error:"User not authenticated. Please log in.",leads:[]});return}t({loading:!0,error:null});try{const r=await fetch("https://dbbackend.devnexussolutions.com/auth/api/get-all-leads",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},credentials:"include"});if(!r.ok){const d=await r.text();t({leads:[],loading:!1,error:`HTTP Error: ${r.status} - ${d}`});return}const c=(await r.json())?.leads||[];t({leads:c,loading:!1,error:null})}catch(r){console.error("Fetch error:",r),t({leads:[],loading:!1,error:"An error occurred while fetching leads"})}}}));function W(){const t=O(),{leads:s,loading:r,error:m,fetchLeads:c}=z(),[d,u]=o.useState({}),[h,p]=o.useState({}),[x,g]=o.useState(!1);o.useEffect(()=>{c()},[]),o.useEffect(()=>{const f={},k={};s.forEach(y=>{f[y._id]=!1,k[y._id]={remark1:"",remark2:""}}),u(f),p(k)},[s]);const b=o.useMemo(()=>Object.values(d).some(Boolean),[d]);return console.log("Leads data:",s),a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Manual Leads"}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>t("/admin-dashboard/mannual-leads/add"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg shadow-sm hover:bg-blue-700",children:"Add Lead"}),a.jsx(L,{className:`text-blue-600 ${b?"cursor-pointer":"opacity-50 cursor-not-allowed"}`,onClick:()=>b&&g(f=>!f),title:b?x?"Hide Global Remarks":"Show Global Remarks":"Select at least one row to enable"})]})]}),r&&a.jsx("p",{children:"Loading leads..."}),m&&a.jsx("p",{className:"text-red-600",children:m}),a.jsx(q,{leads:s,patchApi:"https://dbbackend.devnexussolutions.com/user/leads",enabledRows:d,setEnabledRows:u,remarks:h,setRemarks:p,showGlobalRemarks:x})]})}export{W as default};
