import{j as e}from"./index-ePZmuw5s.js";import{i as b,u as f,r as i}from"./react-DNgDP3D6.js";import{u as y}from"./UsersGet-DoIcZEnz.js";function E(){const{userId:t}=b(),m=f(),{users:n,loading:x,error:d,fetchUser:h}=y(),[r,c]=i.useState({name:"",email:"",role:"",lastLogin:"",loginHistory:[]});i.useEffect(()=>{h()},[]),i.useEffect(()=>{if(n?.users&&t){const s=n.users.find(a=>a._id===t);s&&c({name:s.name||"",email:s.email||"",role:s.role||"",lastLogin:s.lastLogin||"",loginHistory:s.loginHistory||[]})}},[n,t]);const o=s=>{const{name:a,value:l}=s.target;c(u=>({...u,[a]:l}))},p=async s=>{s.preventDefault();try{const a=localStorage.getItem("User"),l=a?JSON.parse(a).token:null;if(!l)throw new Error("No auth token found. Please login first.");if(!(await fetch(`https://dbbackend.devnexussolutions.com/auth/api/update-user/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(r)})).ok)throw new Error("Failed to update user");alert("User updated successfully ✅"),m("/admin-dashboard/users")}catch(a){console.error("Update error:",a),alert("Error updating user ❌")}};if(x)return e.jsx("p",{className:"text-center mt-10",children:"Loading user data..."});if(d)return e.jsxs("p",{className:"text-center mt-10 text-red-600",children:["Error loading user data: ",d]});const g=s=>s?new Date(s).toLocaleString():"";return e.jsxs("div",{className:"max-w-3xl mx-auto p-6 bg-white rounded shadow mt-10",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-6",children:["Edit User: ",r.name]}),e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Name"}),e.jsx("input",{name:"name",value:r.name,onChange:o,required:!0,className:"mt-1 w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Full Name"})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Email"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:o,required:!0,className:"mt-1 w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email"})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Role"}),e.jsxs("select",{name:"role",value:r.role,onChange:o,className:"mt-1 w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"User"})]})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Last Login"}),e.jsx("input",{type:"text",name:"lastLogin",value:r.lastLogin,onChange:o,className:"mt-1 w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Last login timestamp"})]}),e.jsx("button",{type:"submit",className:"mt-4 bg-blue-600 text-white font-semibold px-6 py-2 rounded hover:bg-blue-700 transition",children:"Save Changes"})]}),e.jsxs("section",{className:"mt-10",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Login History"}),r.loginHistory.length===0?e.jsx("p",{className:"text-gray-500",children:"No login history available."}):e.jsx("div",{className:"overflow-x-auto border rounded",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Login At"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"IP Address"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"User Agent"})]})}),e.jsx("tbody",{children:r.loginHistory.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:g(s.loginAt)}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:s.ip}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:s.userAgent})]},s._id))})]})})]})]})}export{E as default};
