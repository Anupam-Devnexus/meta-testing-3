import{j as t,m as M,S as q,k as D,l as $}from"./index-ePZmuw5s.js";import{r as o}from"./react-DNgDP3D6.js";function X({apiData:u,patchApi:j=""}){const i=o.useMemo(()=>u?Array.isArray(u)?u:u.submissions||u.leads||[]:[],[u]),[c,N]=o.useState({}),[m,R]=o.useState({}),[f,E]=o.useState({}),[O,A]=o.useState(!1),[x,k]=o.useState(""),[b,G]=o.useState(""),[T,y]=o.useState(!1),[g,w]=o.useState(""),[I,F]=o.useState(["New Lead","Appointment Scheduled","Called","Hot Lead","Converted","Other"]),[C,v]=o.useState(!1),p=Object.values(c).some(Boolean);o.useEffect(()=>{const e={},s={},a={};i.forEach((r,n)=>{const d=r._id||r.id||n;e[d]=!1,s[d]={remark1:r.remarks1||"",remark2:r.remarks2||""},a[d]=r.tags||[]}),N(e),R(s),E(a)},[i]);const P=e=>e.email||e.user_email||e.field_data?.find(s=>s.name.toLowerCase().includes("email"))?.values?.[0]||"",U=e=>e.phone||e.field_data?.find(s=>s.name.toLowerCase().includes("phone"))?.values?.[0]||"",H=e=>N(s=>({...s,[e]:!s[e]})),L=e=>{e==="Other"?(y(!0),k("")):(k(e),y(!1))},B=()=>{g.trim()&&(F(e=>[g,...e.filter(s=>s!=="Other"),"Other"]),k(g),w(""),y(!1))},W=()=>{R(e=>{const s={...e};return Object.keys(c).filter(a=>c[a]).forEach(a=>{s[a]={remark1:x,remark2:b}}),s})},z=()=>{i.forEach((e,s)=>{const a=e._id||e.id||s;if(!c[a])return;const r=U(e);if(!r)return;const n=encodeURIComponent(`Hello ${e.name||e.full_name||"Customer"},
Remark 1: ${m[a]?.remark1||x}
Remark 2: ${m[a]?.remark2||b}`);window.open(`https://wa.me/${r}?text=${n}`,"_blank")})},J=()=>{i.forEach((e,s)=>{const a=e._id||e.id||s;if(!c[a])return;const r=P(e);if(!r)return;const n=encodeURIComponent("Follow Up"),d=encodeURIComponent(`Hi ${e.name||e.full_name||"Customer"},

Remark 1: ${m[a]?.remark1||x}
Remark 2: ${m[a]?.remark2||b}

Thanks,
Team`);window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${r}&su=${n}&body=${d}`,"_blank")})},K=async()=>{if(!j)return alert("Patch API endpoint not provided.");v(!0);try{const e=JSON.parse(localStorage.getItem("UserDetails")),s=Object.keys(c).filter(l=>c[l]).map(l=>{const h=i.find(_=>(_._id||_.id)===l);return h?{_id:h._id||h.id,remarks1:m[l]?.remark1||h.remarks1||"",remarks2:m[l]?.remark2||h.remarks2||"",tags:f[l]?.length?f[l]:h.tags||[]}:null}).filter(Boolean);if(!s.length)return alert("No rows selected to update.");const a=s.map(l=>l._id),r={remarks1:s[0].remarks1,remarks2:s[0].remarks2,tags:s[0].tags},n=await fetch(j,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:e?`Bearer ${e.token}`:""},body:JSON.stringify({ids:a,updateData:r})});if(!n.ok)throw new Error("Failed to submit changes.");const d=await n.json();console.log("Patch response:",d)}catch(e){console.error("Error submitting:",e)}finally{v(!1)}};if(!i.length)return t.jsx("p",{className:"text-gray-500",children:"No data available"});const S=o.useMemo(()=>{if(!i.length)return[];const e=i[0].field_data?.map(a=>a.name)||[];return[...["name","email","phone","status","createdAt"],...e]},[i]);return t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(M,{onClick:z,className:`p-1 bg-green-600 text-white text-3xl rounded-md cursor-pointer shadow-sm hover:bg-green-700 transition ${p?"":"opacity-50 cursor-not-allowed"}`,title:"Send WhatsApp"}),t.jsx(q,{onClick:J,className:`p-1 bg-red-600 text-white text-3xl rounded-md cursor-pointer shadow-sm hover:bg-red-700 transition ${p?"":"opacity-50 cursor-not-allowed"}`,title:"Send Email"}),t.jsx(D,{onClick:()=>p&&A(e=>!e),className:`text-blue-600 text-2xl cursor-pointer ${p?"":"opacity-50 cursor-not-allowed"}`,title:"Global Remarks"}),t.jsx("button",{onClick:K,disabled:!p||C,className:"ml-auto px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:C?"Submitting...":"Submit Changes"})]}),O&&t.jsxs("div",{className:"w-full bg-white border border-gray-200 rounded-lg shadow-sm p-4 flex flex-wrap gap-3 items-center",children:[t.jsxs("select",{value:x,onChange:e=>L(e.target.value),disabled:!p,className:"px-4 py-2 border-b border-gray-300 text-sm disabled:opacity-50",children:[t.jsx("option",{value:"",children:"Select Remark 1"}),I.map((e,s)=>t.jsx("option",{value:e,children:e},s))]}),T&&t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("input",{type:"text",placeholder:"Enter custom remark",value:g,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm"}),t.jsx("button",{onClick:B,className:"flex items-center gap-1 px-2 py-2 bg-green-600 text-white rounded-full shadow-sm hover:bg-green-700",children:t.jsx($,{})})]}),t.jsx("input",{type:"text",placeholder:"Enter Remark 2",value:b,onChange:e=>G(e.target.value),className:"px-4 py-2 border-b border-gray-300 text-sm outline-none flex-1"}),t.jsx("button",{onClick:W,className:"flex items-center gap-2 px-2 py-2 bg-blue-600 text-white rounded-full shadow-sm hover:bg-blue-700",children:t.jsx($,{className:"text-lg"})})]}),t.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow border",children:t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-2 px-4 border text-center",children:"Select"}),S.map((e,s)=>t.jsx("th",{className:"py-2 px-4 border capitalize",children:e},s)),t.jsx("th",{className:"py-2 px-4 border",children:"Remarks"}),t.jsx("th",{className:"py-2 px-4 border",children:"Tags"})]})}),t.jsx("tbody",{children:i.map((e,s)=>{const a=e._id||e.id||s;return t.jsxs("tr",{className:`hover:bg-gray-50 ${c[a]?"bg-gray-100":""}`,children:[t.jsx("td",{className:"py-2 px-4 border text-center",children:t.jsx("input",{type:"checkbox",checked:c[a]||!1,onChange:()=>H(a),className:"w-5 h-5 accent-blue-500"})}),S.map((r,n)=>{if(e[r]!==void 0)return t.jsx("td",{className:"py-2 px-4 border",children:e[r]||"-"},n);const d=e.field_data?.find(l=>l.name===r);return t.jsx("td",{className:"py-2 px-4 border",children:d?.values?.[0]||"-"},n)}),t.jsx("td",{className:"py-2 px-4 border text-xs",children:m[a]?.remark2||"-"}),t.jsxs("td",{className:"py-2 px-4 border",children:[t.jsx("div",{className:"flex flex-wrap gap-1 mb-1",children:f[a]?.map((r,n)=>t.jsx("span",{className:`px-2 py-1 text-xs rounded ${r.color}`,children:r.text},n))}),t.jsx("p",{className:"font-semibold",children:m[a]?.remark1||"-"})]})]},a)})})]})})]})}export{X as D};
