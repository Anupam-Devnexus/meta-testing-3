import{G as B,j as s,h as se,i as ae,k as re,l as O,m as le,S as oe,n as ne,o as ce}from"./index-ePZmuw5s.js";import{r}from"./react-DNgDP3D6.js";import{u as ie}from"./MetaLeadsGet-DbKrsk6c.js";import{m as de,u as me}from"./NewMetaLeads-DnDEfBrt.js";function ue(o){return B({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M217.9 256L345 129c9.4-9.4 9.4-24.6 0-33.9-9.4-9.4-24.6-9.3-34 0L167 239c-9.1 9.1-9.3 23.7-.7 33.1L310.9 417c4.7 4.7 10.9 7 17 7s12.3-2.3 17-7c9.4-9.4 9.4-24.6 0-33.9L217.9 256z"},child:[]}]})(o)}function he(o){return B({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M294.1 256L167 129c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.3 34 0L345 239c9.1 9.1 9.3 23.7.7 33.1L201.1 417c-4.7 4.7-10.9 7-17 7s-12.3-2.3-17-7c-9.4-9.4-9.4-24.6 0-33.9l127-127.1z"},child:[]}]})(o)}const G=["phone","mobile","contact_number","PHONE_NUMBER","number"],P=["email","EMAIL_ID","contact_email","mail"];function fe(){const{metaleads:o,fetchMetaLeads:U}=ie(),{fetchinsights:H}=de(),{fetchNewMeta:K}=me(),[u,z]=r.useState([]),[n,v]=r.useState({}),[c,R]=r.useState({}),[x,f]=r.useState(""),[p,V]=r.useState(""),[b,C]=r.useState(""),[D,w]=r.useState(!1),[W,T]=r.useState(["New Lead","Appointment Scheduled","Called","Hot Leads","Converted","Other"]),[S,q]=r.useState(!1),[h,j]=r.useState(1),[L,J]=r.useState(""),k=7,F=["created_time","created_at"],_=(e,t)=>{if(!e)return null;const a=Object.keys(e),l=a.map(i=>i.toLowerCase());for(let i of t){const m=l.indexOf(i.toLowerCase());if(m!==-1)return a[m]}return null};r.useEffect(()=>{U(),H(),K()},[]),r.useEffect(()=>{if(o?.leads){z(o.leads);const e={},t={};o.leads.forEach(a=>{e[a._id]=!1,t[a._id]={remark1:"",remark2:""}}),v(e),R(t)}},[o]);const d=Object.values(n).some(Boolean),Q=e=>v(t=>({...t,[e]:!t[e]})),X=e=>{e==="Other"?(w(!0),f("")):(f(e),w(!1))},Y=()=>{b.trim()&&(T(e=>[b,...e.filter(t=>t!=="Other"),"Other"]),f(b),C(""),w(!1))},Z=()=>{const e={...c};Object.keys(n).filter(t=>n[t]).forEach(t=>{e[t]={remark1:x,remark2:p}}),R(e)},A=u[0]?.AllFields?Object.keys(u[0].AllFields):[],E=["Select","ID",...F.map(e=>e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())),...A.map(e=>G.includes(e.toLowerCase())?"Phone Number":P.includes(e.toLowerCase())?"Email":e.charAt(0).toUpperCase()+e.slice(1)),"Tags","Remark 1","Remark 2","Actions"],$=u.filter(e=>Object.values(e.AllFields||{}).join(" ").toLowerCase().includes(L.toLowerCase())).map(e=>{const t=F.map(l=>e[l]||"-"),a=A.map(l=>e.AllFields[l]||"-");return[e._id,...t,...a]}),y=Math.ceil($.length/k),I=$.slice((h-1)*k,h*k),ee=()=>{const e=u.filter(t=>n[t._id]);if(e.length===0){alert("No row selected");return}e.forEach(t=>{let a=t.phone||null;if(!a){const g=_(t.AllFields,G);g&&(a=t.AllFields[g])}if(!a)return;const l=c[t._id]?.remark1||x,i=c[t._id]?.remark2||p,m=`Hello ${t.name||"there"},
Remark1: ${l}
Remark2: ${i}`,N=`https://wa.me/${a}?text=${encodeURIComponent(m)}`;window.open(N,"_blank")})},te=()=>{const e=u.filter(t=>n[t._id]);if(e.length===0){alert("No row selected");return}e.forEach(t=>{let a=t.email||null;if(!a){const M=_(t.AllFields,P);M&&(a=t.AllFields[M])}if(!a)return;const l=c[t._id]?.remark1||x,i=c[t._id]?.remark2||p,m="Lead Follow-up",N=`Hello ${t.name||"there"},
Remark1: ${l}
Remark2: ${i}

Best Regards`,g=`https://mail.google.com/mail/?view=cm&fs=1&to=${a}&su=${encodeURIComponent(m)}&body=${encodeURIComponent(N)}`;window.open(g,"_blank")})};return s.jsxs("section",{className:"w-full bg-gray-50 min-h-screen p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("h1",{className:"text-2xl font-bold text-blue-700 flex items-center gap-2",children:[s.jsx(se,{className:"text-blue-500"})," Meta Leads"]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"flex items-center bg-white px-3 py-2 rounded-lg shadow-sm border",children:[s.jsx(ae,{className:"text-gray-400 mr-2"}),s.jsx("input",{type:"text",placeholder:"Search leads...",value:L,onChange:e=>J(e.target.value),className:"outline-none text-sm w-60"})]}),s.jsx(re,{className:`text-blue-600 text-lg cursor-pointer transition ${d?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>d&&q(e=>!e),title:d?S?"Hide Global Remarks":"Show Global Remarks":"Select at least one row to enable"})]})]}),S&&s.jsxs("div",{className:"w-full bg-white border border-gray-200 rounded-lg shadow-sm p-4 flex flex-wrap gap-3 items-center mb-4",children:[s.jsxs("select",{value:x,onChange:e=>X(e.target.value),disabled:!d,className:"px-4 py-2 border-b border-gray-300 text-sm disabled:opacity-50",children:[s.jsx("option",{value:"",children:"Select Remark 1"}),W.map((e,t)=>s.jsx("option",{value:e,children:e},t))]}),D&&s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx("input",{type:"text",placeholder:"Enter custom remark",value:b,onChange:e=>C(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none"}),s.jsx("button",{onClick:Y,className:"flex items-center gap-1 px-2 py-2 bg-green-600 text-white rounded-full shadow-sm hover:bg-green-700 transition",children:s.jsx(O,{})})]}),s.jsx("input",{type:"text",placeholder:"Enter Remark 2",value:p,onChange:e=>V(e.target.value),className:"px-4 py-2 border-b border-gray-300 text-sm outline-none flex-1"}),s.jsx("button",{onClick:Z,className:"flex items-center gap-2 px-2 py-2 bg-blue-600 text-white rounded-full shadow-sm hover:bg-blue-700 transition",children:s.jsx(O,{className:"text-lg"})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(le,{onClick:ee,className:`p-1 bg-green-600 text-white text-3xl rounded-md cursor-pointer shadow-sm hover:bg-green-700 transition ${d?"":"opacity-50 cursor-not-allowed"}`,title:"Send WhatsApp Message"}),s.jsx(oe,{onClick:te,className:`p-1 bg-red-600 text-white text-3xl rounded-md cursor-pointer shadow-sm hover:bg-red-700 transition ${d?"":"opacity-50 cursor-not-allowed"}`,title:"Send Email via Gmail"})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full bg-white rounded-xl shadow-md divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-blue-50",children:s.jsx("tr",{children:E.map(e=>s.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-blue-800 uppercase tracking-wider",children:e},e))})}),s.jsxs("tbody",{className:"divide-y divide-gray-100",children:[I.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:E.length,className:"py-6 text-center text-gray-400",children:"No leads found."})}),I.map(e=>{const t=e[0];return s.jsxs("tr",{className:`transition-all duration-200 hover:shadow-sm ${n[t]?"bg-green-50":"bg-white"}`,children:[s.jsx("td",{className:"px-4 py-3 text-center",children:s.jsx("input",{type:"checkbox",checked:n[t]||!1,onChange:()=>Q(t),className:"w-5 h-5 accent-blue-500"})}),e.map((a,l)=>s.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-gray-700 text-sm",children:a},l)),s.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-600",children:c[t]?.remark1||"-"}),s.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-600",children:c[t]?.remark2||"-"}),s.jsxs("td",{className:"px-4 py-3 flex items-center gap-2",children:[s.jsx("button",{className:"text-blue-600 hover:text-blue-800 p-2 rounded-full hover:bg-blue-50 transition",children:s.jsx(ne,{size:18})}),s.jsx("button",{className:"text-red-600 hover:text-red-800 p-2 rounded-full hover:bg-red-50 transition",children:s.jsx(ce,{size:20})})]})]},t)})]})]})}),y>1&&s.jsxs("div",{className:"mt-6 flex justify-center items-center space-x-2",children:[s.jsx("button",{disabled:h===1,onClick:()=>j(e=>e-1),className:"p-2 bg-white rounded-lg shadow-sm hover:bg-blue-50 disabled:opacity-50",children:s.jsx(ue,{})}),[...Array(y)].map((e,t)=>s.jsx("button",{onClick:()=>j(t+1),className:`px-4 py-2 rounded-lg text-sm font-medium transition ${h===t+1?"bg-blue-600 text-white shadow":"bg-white text-gray-700 hover:bg-blue-50"}`,children:t+1},t)),s.jsx("button",{disabled:h===y,onClick:()=>j(e=>e+1),className:"p-2 bg-white rounded-lg shadow-sm hover:bg-blue-50 disabled:opacity-50",children:s.jsx(he,{})})]})]})}export{fe as default};
